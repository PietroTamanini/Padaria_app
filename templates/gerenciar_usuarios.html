{% extends "base.html" %}

{% block title %}Gerenciar Usuários - A Turma do Forno{% endblock %}

{% block content %}
<div class="gerenciar-usuarios">
    <h2><i class="fas fa-user-cog"></i> Gerenciar Usuários</h2>
    
    {% if error %}
    <div class="error-message">{{ error }}</div>
    {% endif %}
    
    <div class="add-user-form">
        <h3>Adicionar Novo Usuário</h3>
        <form method="POST" action="{{ url_for('adicionar_usuario') }}">
            <div class="form-row">
                <div class="form-group">
                    <label for="nome">Nome:</label>
                    <input type="text" id="nome" name="nome" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="senha">Senha:</label>
                    <input type="password" id="senha" name="senha" required>
                </div>
                
                <div class="form-group">
                    <label for="tipo">Tipo de Usuário:</label>
                    <select id="tipo" name="tipo" required>
                        <option value="">Selecione o tipo</option>
                        <option value="rh">RH (Visualizar estoque e relatórios)</option>
                        <option value="pdv">PDV (Realizar vendas)</option>
                        <option value="estoquista">Estoquista (Alterar estoque)</option>
                        <option value="cadastrador">Cadastrador (Cadastrar produtos)</option>
                        <option value="cliente">Cliente (Fazer pedidos)</option>
                    </select>
                </div>
            </div>
            
            <button type="submit" class="btn-primary">Adicionar Usuário</button>
        </form>
    </div>
    
    <div class="users-list">
        <h3>Usuários Cadastrados</h3>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Tipo</th>
                        <th>Permissões</th>
                        <th>Data de Criação</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.nome }}</td>
                        <td>{{ user.email }}</td>
                        <td>
                            {% if user.tipo == 'admin' %}
                            <span class="badge admin">Administrador</span>
                            {% elif user.tipo == 'rh' %}
                            <span class="badge rh">RH</span>
                            {% elif user.tipo == 'pdv' %}
                            <span class="badge pdv">PDV</span>
                            {% elif user.tipo == 'estoquista' %}
                            <span class="badge estoquista">Estoquista</span>
                            {% elif user.tipo == 'cadastrador' %}
                            <span class="badge cadastrador">Cadastrador</span>
                            {% elif user.tipo == 'cliente' %}
                            <span class="badge cliente">Cliente</span>
                            {% endif %}
                        </td>
                        <td>
                            {% for permissao in user.permissoes %}
                            <span class="badge permissao">{{ permissao }}</span>
                            {% endfor %}
                        </td>
                        <td>{{ user.data_criacao }}</td>
                        <td>
                            {% if user.id != session.user_id and user.email != 'admin@admin.turma.do.forno' %}
                            <a href="{{ url_for('excluir_usuario', user_id=user.id) }}" 
                               class="btn-danger" 
                               onclick="return confirm('Tem certeza que deseja excluir este usuário?')">
                                Excluir
                            </a>
                            {% else %}
                            <span class="text-muted">Não permitido</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}